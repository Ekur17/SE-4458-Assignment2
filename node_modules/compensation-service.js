const amqp = require("amqplib");

const rabbitUrl = "amqp://localhost";
let channel;

// RabbitMQ bağlantısı
async function connectRabbitMQ() {
  const connection = await amqp.connect(rabbitUrl);
  channel = await connection.createChannel();
  await channel.assertQueue("compensation_queue");

  // compensation_queue'yu dinle
  channel.consume("compensation_queue", async (msg) => {
    const booking = JSON.parse(msg.content.toString());
    console.log(
      `Compensating transaction: cancelling bookingId: ${booking.id}`
    );

    // Burada rezervasyonu iptal etmek için gerekli işlemleri yapabilirsiniz
    // Örneğin, rezervasyonu veritabanında 'CANCELLED' olarak işaretleyebilirsiniz

    channel.ack(msg); // Mesajı işleme alındı olarak işaretle
  });
}

connectRabbitMQ();
